* Big Data  (Non-designed) (Designed)
** Generate 
 Generate data 
  #+begin_src lisp  :results silent  :exports code  
    (defparameter *bigdata* nil)
    (with-open-file (stream (merge-pathnames "bigdata-nd.csv" *img-path*) :direction :output
									  :if-exists :supersede)
      (let (bigdata)
	(loop for h from 3 to 4 by 0.5 do 
	  (loop for n from 2 to (truncate 40 h) by 1 do
	    (loop for bw from 3 to 6 by 0.5 do 
	      (loop for bx from 2 to 5 do
		(loop for by from bx to 5 
		      for exact = (simple-building-ftp* :number-of-storey n
							:height h
							:bays-x bx
							:bays-y by
							:bay-width bw
							:designed nil)
		      do 
			 (cl-csv:write-csv-row (list n h bw bx by exact)
					       :stream stream)
			 (push (list (list n h bw bx by) exact) bigdata))))))
	(setf *bigdata* bigdata)))

    #+end_src

** Read
   #+begin_src lisp
     (let (bigdata)
       (cl-csv:read-csv (merge-pathnames "bigdata-nd.csv" *img-path*)
			:data-map-fn #'(lambda (data &key csv-reader)
					 (declare (ignore csv-reader))
					 (let (( *read-default-float-format* 'double-float))
					   (read-from-string data)))
			:row-fn #'(lambda (row)
				    (push (list (butlast row) (first (last row)))
					  bigdata)))
       (setf *bigdata* (reverse bigdata)))

nil
   #+end_src  

   #+RESULTS:
   : NIL

* Simple Fit
  T = a*N^b*h^c 
  #+Name: simpleFit 
  #+begin_src lisp 
    (max-fit-%diff (lambda (x a b c)
		     (destructuring-bind (n h bw bx by) x
		       (* a
			  (expt n b)
			  (expt h c))))
		   '(1 1 1))
  #+end_src

  #+RESULTS: simpleFit
  | max %diff |      R^2 |     rmse | Params                       |
  |  8.215055 | 0.995390 | 0.015803 | (0.025761 0.990109 0.917816) |

  Simpler: T = a(Nh)^b
  #+begin_src lisp 
    (max-fit-%diff (lambda (x a b)
		     (destructuring-bind (n h bw bx by) x
		       (* a
			  (expt (* n h) b)
			  )))
		   '(1 1)
		   :save '/simpler-fit)
  #+end_src

  #+RESULTS:
  | max %diff |      R^2 |     rmse | Params              |
  |  9.125395 | 0.994939 | 0.016554 | (0.023657 0.988867) |

  The difference in R^2 of simple vs simpler formula is not much. And they explain almost 99% of the variation.

* N
  Buildings with N=1 are like outliers, and degrade the regression.  So skip them.
  #+begin_src lisp
    (max-fit-%diff (lambda (x a b)
		     (* a (expt (first x) b)))
		   '(1 1)
		   :data (filter-data :h 3.5 :bw 5 :bx 4 :by 4)
		   :save '/simpler-N-fit)
  #+end_src

  #+RESULTS:
  | max %diff |      R^2 |     rmse | Params              |
  |  1.563193 | 0.999980 | 0.001098 | (0.079616 0.989822) |

  #+begin_src lisp :results file 
     (scatter-plot /simpler-N-fit "psimpler-N-fit.png" (filter-data :h 3.5 :bw 5 :bx 4 :by 4))
  #+end_src

  #+RESULTS:
  [[file:./img/psimpler-N-fit.png]]

  So, for any given H,bw,bx,by. The formula T=aN*b explains most of the variation (99.98%).
  The constants a, and b varry as follows.
  #+begin_src lisp 
    (table 5 (row "H" "params" "R^2" "RMSE")
      (loop for h from 3 to 4 by 0.5 do
	    (multiple-value-bind (params r^2 rmse) (fit::fit (lambda (x a b)
							  (* a (expt (first x) b)))
							(filter-data :h h :bw 5 :bx 4 :by 4)
							'(1 1)
							t nil)
	  (row h params r^2 rmse))))
  #+end_src

  #+RESULTS:
  |       H | params            |     R^2 |    RMSE |
  |       3 | (0.06963 0.99158) | 0.99998 | 0.00100 |
  | 3.50000 | (0.07962 0.98982) | 0.99998 | 0.00110 |
  | 4.00000 | (0.08998 0.98875) | 0.99998 | 0.00120 |

After testing with other combinations of bw, bx, and by too. It is clear that, the exponent of N in the formula T =a*N^b remains almost same, withing 0.98 to 0.99. and the explained variation is above 99%.


Thus we have established that when N is independent variable T = aN^b is the formula for timeperiod.  
#+begin_src lisp 
  (fit::partial-fit (mapcar (lambda (d)
			     (destructuring-bind (x tp) d
			       (destructuring-bind (n . r) x
				 (list n r tp))))
			   ,*bigdata*)
		   #'*
		   #'(lambda (n b)
		       (expt n b))
		   '(1)
		   t
		   t
		   1000)
#+end_src
d
#+RESULTS:
| Parameter                          |          Confidence +/- |
| 0.9902215269790791d0               |   0.11424895986490906d0 |
| chisq/dof (for all parameters too) |   0.04756090410494799d0 |
| R^2                                |    0.9999807320702044d0 |
| RMS                                | 0.0010209870527485708d0 |

The best value for the exponent b is found to be 0.9847.
And since RMSE = 0.001, if for a given building the coefficient a is known then T = aN^0.9847 gives timeperiod within 2*0.001 = 0.002 seconds with 95% confidence. 

* h
  after checking with T/N^0.9847 = a h, a(h+b), ah^b. a(h+b) thre goodness of fit are near about. 
  #+begin_src lisp 
    (append
     (max-fit-%diff (lambda (x a b) (* a (+ (second x) b) (expt (first x) 0.9847)))
		    '(1 1))
     (max-fit-%diff (lambda (x a b) (* a (expt (second x) b) (expt (first x) 0.9847)))
		    '(1 1))
     (max-fit-%diff (lambda (x a) (* a (second x) (expt (first x) 0.9847)))
		    '(1)))

  #+end_src

  #+RESULTS:
  | max %diff |      R^2 |     rmse | Params              |
  |  8.351377 | 0.995367 | 0.015839 | (0.021494 0.326036) |
  | max %diff |      R^2 |     rmse | Params              |
  |  8.318934 | 0.995372 | 0.015831 | (0.026214 0.913078) |
  | max %diff |      R^2 |     rmse | Params              |
  |  9.504357 | 0.994718 | 0.016908 | (0.023542)          |

  #+begin_src lisp
    (fit::partial-fit (mapcar (lambda (d)
				 (destructuring-bind (x tp) d
				   (destructuring-bind (n h . r) x
				     (list (list n h) r tp))))
			       *bigdata*)
		       #'*
		       #'(lambda (nh a b)
			   (* a (expt (second nh) b) (expt (first nh) 0.9847)))
		       '(1 1)
		       t
		       t)
  #+end_src

  #+RESULTS:
  | Parameter                          |         Confidence +/- |
  | 0.1610438788730471d0               |   3.002604704245855d12 |
  | 0.9140651928959022d0               |   0.3377979703663743d0 |
  | chisq/dof (for all parameters too) |   0.3301120790771905d0 |
  | R^2                                |    0.999071765548038d0 |
  | RMS                                | 0.007086496042001423d0 |

  #+begin_src lisp 
    (fit::partial-fit (mapcar (lambda (d)
				(destructuring-bind (x tp) d
				  (destructuring-bind (n h . r) x
				    (list (list n h) r tp))))
			      ,*bigdata*)
		      #'*
		      #'(lambda (nh a b)
			  (* a (+ (second nh) b) (expt (first nh) 0.9847)))
		      '(1 1)
		      t
		      t)
  #+end_src

  #+RESULTS:
  | Parameter                          |         Confidence +/- |
  | -0.2184548037124398d0              |  3.9525919728590435d12 |
  | 0.32190177899483896d0              |   1.5605206313727522d0 |
  | chisq/dof (for all parameters too) |   0.3310312276894695d0 |
  | R^2                                |   0.9990665892867178d0 |
  | RMS                                | 0.007106227349686802d0 |
  
  #+begin_src lisp :results file 
    (with-plot "ph1.png"
      (setup :xlabel "h" :ylabel "T/N^{0.9847}")
      (ezplot (mapcar (lambda (d)
		     (destructuring-bind (x tp) d
		       (list (second x) (/ tp (expt (first x) 0.9847)))))
		   (filter-data :bw 5 :bx 4 :by 4))
	      :with '(:point)))
  #+end_src

  #+RESULTS:
  [[file:./img/ph1.png]]

  with T = a (h + b) N^0.9847
  #+begin_src lisp 
    (table 5 (row "BW" "params" "R^2" "RMSE")
      (loop for bw from 3 to 7 by 1 do
	(multiple-value-bind (params r^2 rmse)
	    (fit::fit (lambda (x a b)
			(* a
			   (+ (second x) b)
			   (expt (first x) 0.9847)))
		      (filter-data :bw bw :bx 2  :by 2)
		      '(1 1)
		      t nil)
	  (row bw params r^2 rmse))))
  #+end_src

  #+RESULTS:
  |      BW | params             |     R^2 |    RMSE |
  | 3.00000 | (0.02131 0.47153)  | 0.99948 | 0.04185 |
  | 4.00000 | (0.02432 -0.06094) | 0.99995 | 0.01328 |
  | 5.00000 | (0.02003 0.56685)  | 0.99996 | 0.01130 |
  | 6.00000 | (0.01739 1.16420)  | 0.99996 | 0.01052 |
  | 7.00000 | (0.01566 1.71743)  | 0.99997 | 0.01034 |
  a and b both change with BW, but a changes less with bx,by.
  
  with T = a h^b N^0.9847
  #+begin_src lisp 
    (table 5 (row "BW" "params" "R^2" "RMSE")
      (loop for bw from 3 to 7 by 1 do
	(multiple-value-bind (params r^2 rmse)
	    (fit::fit (lambda (x a b)
			(* a
			   (expt (second x) b)
			   (expt (first x) 0.9847)))
		      (filter-data :bw bw :bx 4 :by 4)
		      '(1 1)
		      t nil)
	  (row bw params r^2 rmse))))
  #+end_src

  #+RESULTS:
  |      BW | params            |     R^2 |    RMSE |
  | 3.00000 | (0.02570 0.92491) | 0.99954 | 0.03822 |
  | 4.00000 | (0.02148 1.05546) | 0.99995 | 0.01218 |
  | 5.00000 | (0.02556 0.89372) | 0.99995 | 0.01165 |
  | 6.00000 | (0.02923 0.78040) | 0.99996 | 0.01119 |
  | 7.00000 | (0.03253 0.69859) | 0.99996 | 0.01092 |

  both changes with BW, and also both change only slightly with bx by 

  #+begin_src lisp 
    (table 5 (row "BW" "params" "R^2" "RMSE")
      (loop for bw from 3 to 7 by 1 do
	(multiple-value-bind (params r^2 rmse)
	    (fit::fit (lambda (x a b)
			(* a
			   (expt (second x) b)
			   (expt (first x) 0.9847)))
		      (filter-data :bw bw)
		      '(1 1)
		      t nil)
	  (row bw params r^2 rmse))))

  #+end_src

  #+RESULTS:
  |      BW | params            |     R^2 |    RMSE |
  | 3.00000 | (0.02771 0.89657) | 0.99753 | 0.29162 |
  | 4.00000 | (0.02308 1.03250) | 0.99765 | 0.28074 |
  | 5.00000 | (0.02751 0.87161) | 0.99739 | 0.28853 |
  | 6.00000 | (0.03153 0.75914) | 0.99717 | 0.29958 |
  | 7.00000 | (0.03513 0.67813) | 0.99698 | 0.31248 |

  #+begin_src lisp 
    (max-fit-%diff (lambda (x a b)
		     (* a
			(expt (second x) b)
			(expt (first x) 0.9847)))
		   '(1 1)
		   :save '/simpler-h-fit)
  #+end_src

  #+RESULTS:
  | max %diff |      R^2 |     rmse | Params              |
  |  8.318934 | 0.995372 | 0.015831 | (0.026214 0.913078) |

* Bwx and Bwy 
  #+begin_src lisp 
    (let ((hashtable (make-hash-table :test #'equal)))
      (defun asym-building-ftp* (&rest params &key number-of-storey height bays-x bays-y bay-width (bare nil) (strut t) (designed t) (typical nil))
	(let ((ftp? (gethash params hashtable)))
	  (if ftp?
	      ftp?
	      (setf (gethash params hashtable)
		    (nth-value 2
			       (asym-simple-building :number-of-storey number-of-storey
						:height height
						:bays-x bays-x
						:bays-y bays-y
						:bay-width bay-width
						:strut strut
						:bare bare
						:designed designed
						:typical typical))))))
      (defun asym-building-ftp*-clear ()
	(setf hashtable (make-hash-table :test #'equal))))

    (defun asym-simple-building (&key number-of-storey height bays-x bays-y bay-width (bare nil) (strut t) (designed t) (typical nil))
      (reporting-let* ((geometry (make-building-geometry :number-of-storey number-of-storey
							 :l (make-array bays-x :initial-element (first bay-width))
							 :b (make-array bays-y :initial-element (second bay-width))
							 :h height
							 :bareframe bare) "Geometry" :default)
		       (structure (make-structural-geometry2 number-of-storey height (apply #'max bay-width) :designed designed :typical typical)
				  "Structure" :default))

	(multiple-value-bind (M xc yc) (mass-matrix geometry structure)
	  (let* ((K (stiffness-matrix geometry structure :xc xc :yc yc :strut strut))
		 (mm (df-matrix m))
		 (kk (df-matrix k))
		 (eigenvalues (magicl:eig (magicl:@ (magicl:inv mm) kk)))
		 (tp (timeperiods eigenvalues)))
	    (report-section "Eigenvalues and timeperiod")
	    (reporting
	     (print "Eignevalues")
	     (print eigenvalues)
	     (print "Timperiods")
	     (print tp))
	    (values mm kk (first tp) tp)))))
  #+end_src

 #+begin_src lisp  :exports code
   (table 10
     (loop for bwx from 3 to 6.01 by 0.2 do 
       (loop for bwy from 3 to 6.01 by 0.2
	     for tp = (asym-building-ftp* :number-of-storey 4
					  :height 3
					  :bays-x 2 
					  :bays-y 5 
					  :bay-width (list bwx bwy)
					  :strut t
					  :designed t
					  :typical t)
	   do (row bwx bwy tp))))
  #+end_src
 #+Name: bwbw
  #+RESULTS:
  |            3 |            3 | 0.2686256174 |
  |            3 | 3.2000000000 | 0.2750449475 |
  |            3 | 3.4000000000 | 0.2815075086 |
  |            3 | 3.6000001000 | 0.2887240294 |
  |            3 | 3.8000002000 | 0.2948927213 |
  |            3 | 4.0000000000 | 0.3009349907 |
  |            3 | 4.2000000000 | 0.3068583086 |
  |            3 | 4.3999996000 | 0.3126694294 |
  |            3 | 4.5999994000 | 0.3254340919 |
  |            3 | 4.7999990000 | 0.3312176829 |
  |            3 | 4.9999990000 | 0.3369020021 |
  |            3 | 5.1999990000 | 0.3131222552 |
  |            3 | 5.3999987000 | 0.3180896438 |
  |            3 | 5.5999985000 | 0.3249683780 |
  |            3 | 5.7999983000 | 0.3298044736 |
  |            3 | 5.9999980000 | 0.3345706679 |
  | 3.2000000000 |            3 | 0.2605558383 |
  | 3.2000000000 | 3.2000000000 | 0.2669390132 |
  | 3.2000000000 | 3.4000000000 | 0.2731730777 |
  | 3.2000000000 | 3.6000001000 | 0.2801703650 |
  | 3.2000000000 | 3.8000002000 | 0.2861201078 |
  | 3.2000000000 | 4.0000000000 | 0.2919486233 |
  | 3.2000000000 | 4.2000000000 | 0.2976630355 |
  | 3.2000000000 | 4.3999996000 | 0.3032697884 |
  | 3.2000000000 | 4.5999994000 | 0.3158507094 |
  | 3.2000000000 | 4.7999990000 | 0.3214382205 |
  | 3.2000000000 | 4.9999990000 | 0.3269302507 |
  | 3.2000000000 | 5.1999990000 | 0.3062882491 |
  | 3.2000000000 | 5.3999987000 | 0.3111272294 |
  | 3.2000000000 | 5.5999985000 | 0.3177987588 |
  | 3.2000000000 | 5.7999983000 | 0.3225084043 |
  | 3.2000000000 | 5.9999980000 | 0.3271502523 |
  | 3.4000000000 |            3 | 0.2563012568 |
  | 3.4000000000 | 3.2000000000 | 0.2591298659 |
  | 3.4000000000 | 3.4000000000 | 0.2651474531 |
  | 3.4000000000 | 3.6000001000 | 0.2719446282 |
  | 3.4000000000 | 3.8000002000 | 0.2776871879 |
  | 3.4000000000 | 4.0000000000 | 0.2833133744 |
  | 3.4000000000 | 4.2000000000 | 0.2888299905 |
  | 3.4000000000 | 4.3999996000 | 0.2942431933 |
  | 3.4000000000 | 4.5999994000 | 0.3066367815 |
  | 3.4000000000 | 4.7999990000 | 0.3120381591 |
  | 3.4000000000 | 4.9999990000 | 0.3173476169 |
  | 3.4000000000 | 5.1999990000 | 0.2989222825 |
  | 3.4000000000 | 5.3999987000 | 0.3036267983 |
  | 3.4000000000 | 5.5999985000 | 0.3100895699 |
  | 3.4000000000 | 5.7999983000 | 0.3146670774 |
  | 3.4000000000 | 5.9999980000 | 0.3191789388 |
  | 3.6000001000 |            3 | 0.2618905661 |
  | 3.6000001000 | 3.2000000000 | 0.2545023701 |
  | 3.6000001000 | 3.4000000000 | 0.2589916697 |
  | 3.6000001000 | 3.6000001000 | 0.2646705947 |
  | 3.6000001000 | 3.8000002000 | 0.2702302066 |
  | 3.6000001000 | 4.0000000000 | 0.2756777210 |
  | 3.6000001000 | 4.2000000000 | 0.2810196591 |
  | 3.6000001000 | 4.3999996000 | 0.2862619255 |
  | 3.6000001000 | 4.5999994000 | 0.2984958468 |
  | 3.6000001000 | 4.7999990000 | 0.3037329301 |
  | 3.6000001000 | 4.9999990000 | 0.3088812319 |
  | 3.6000001000 | 5.1999990000 | 0.2922805697 |
  | 3.6000001000 | 5.3999987000 | 0.2968641104 |
  | 3.6000001000 | 5.5999985000 | 0.3031464308 |
  | 3.6000001000 | 5.7999983000 | 0.3076051661 |
  | 3.6000001000 | 5.9999980000 | 0.3120001845 |
  | 3.8000002000 |            3 | 0.2666828467 |
  | 3.8000002000 | 3.2000000000 | 0.2591253027 |
  | 3.8000002000 | 3.4000000000 | 0.2527039405 |
  | 3.8000002000 | 3.6000001000 | 0.2582165996 |
  | 3.8000002000 | 3.8000002000 | 0.2636140082 |
  | 3.8000002000 | 4.0000000000 | 0.2689031032 |
  | 3.8000002000 | 4.2000000000 | 0.2740901572 |
  | 3.8000002000 | 4.3999996000 | 0.2791808518 |
  | 3.8000002000 | 4.5999994000 | 0.2912773527 |
  | 3.8000002000 | 4.7999990000 | 0.2963688242 |
  | 3.8000002000 | 4.9999990000 | 0.3013742923 |
  | 3.8000002000 | 5.1999990000 | 0.2862902248 |
  | 3.8000002000 | 5.3999987000 | 0.2907648097 |
  | 3.8000002000 | 5.5999985000 | 0.2968897210 |
  | 3.8000002000 | 5.7999983000 | 0.3012415567 |
  | 3.8000002000 | 5.9999980000 | 0.3055314090 |
  | 4.0000000000 |            3 | 0.2713905134 |
  | 4.0000000000 | 3.2000000000 | 0.2636671896 |
  | 4.0000000000 | 3.4000000000 | 0.2562306230 |
  | 4.0000000000 | 3.6000001000 | 0.2524685510 |
  | 4.0000000000 | 3.8000002000 | 0.2577215260 |
  | 4.0000000000 | 4.0000000000 | 0.2628695522 |
  | 4.0000000000 | 4.2000000000 | 0.2679186814 |
  | 4.0000000000 | 4.3999996000 | 0.2728743973 |
  | 4.0000000000 | 4.5999994000 | 0.2848515234 |
  | 4.0000000000 | 4.7999990000 | 0.2898133780 |
  | 4.0000000000 | 4.9999990000 | 0.2946917003 |
  | 4.0000000000 | 5.1999990000 | 0.2808801433 |
  | 4.0000000000 | 5.3999987000 | 0.2852564069 |
  | 4.0000000000 | 5.5999985000 | 0.2912427869 |
  | 4.0000000000 | 5.7999983000 | 0.2954982032 |
  | 4.0000000000 | 5.9999980000 | 0.2996931976 |
  | 4.2000000000 |            3 | 0.2760179009 |
  | 4.2000000000 | 3.2000000000 | 0.2681321542 |
  | 4.2000000000 | 3.4000000000 | 0.2605424073 |
  | 4.2000000000 | 3.6000001000 | 0.2538694154 |
  | 4.2000000000 | 3.8000002000 | 0.2524525992 |
  | 4.2000000000 | 4.0000000000 | 0.2574744530 |
  | 4.2000000000 | 4.2000000000 | 0.2624002190 |
  | 4.2000000000 | 4.3999996000 | 0.2672352046 |
  | 4.2000000000 | 4.5999994000 | 0.2791077273 |
  | 4.2000000000 | 4.7999990000 | 0.2839536903 |
  | 4.2000000000 | 4.9999990000 | 0.2887183288 |
  | 4.2000000000 | 5.1999990000 | 0.2759842013 |
  | 4.2000000000 | 5.3999987000 | 0.2802715190 |
  | 4.2000000000 | 5.5999985000 | 0.2861349547 |
  | 4.2000000000 | 5.7999983000 | 0.2903031740 |
  | 4.2000000000 | 5.9999980000 | 0.2944123823 |
  | 4.3999996000 |            3 | 0.2805689812 |
  | 4.3999996000 | 3.2000000000 | 0.2725239774 |
  | 4.3999996000 | 3.4000000000 | 0.2647839889 |
  | 4.3999996000 | 3.6000001000 | 0.2579792127 |
  | 4.3999996000 | 3.8000002000 | 0.2519726751 |
  | 4.3999996000 | 4.0000000000 | 0.2526306193 |
  | 4.3999996000 | 4.2000000000 | 0.2574455645 |
  | 4.3999996000 | 4.3999996000 | 0.2621720929 |
  | 4.3999996000 | 4.5999994000 | 0.2739522134 |
  | 4.3999996000 | 4.7999990000 | 0.2786940998 |
  | 4.3999996000 | 4.9999990000 | 0.2833566440 |
  | 4.3999996000 | 5.1999990000 | 0.2715426203 |
  | 4.3999996000 | 5.3999987000 | 0.2757492469 |
  | 4.3999996000 | 5.5999985000 | 0.2815027177 |
  | 4.3999996000 | 5.7999983000 | 0.2855918481 |
  | 4.3999996000 | 5.9999980000 | 0.2896232467 |
  | 4.5999994000 |            3 | 0.2915853514 |
  | 4.5999994000 | 3.2000000000 | 0.2833682195 |
  | 4.5999994000 | 3.4000000000 | 0.2754545774 |
  | 4.5999994000 | 3.6000001000 | 0.2685020615 |
  | 4.5999994000 | 3.8000002000 | 0.2623685160 |
  | 4.5999994000 | 4.0000000000 | 0.2569334607 |
  | 4.5999994000 | 4.2000000000 | 0.2597603002 |
  | 4.5999994000 | 4.3999996000 | 0.2645760557 |
  | 4.5999994000 | 4.5999994000 | 0.2693057101 |
  | 4.5999994000 | 4.7999990000 | 0.2739537285 |
  | 4.5999994000 | 4.9999990000 | 0.2785241923 |
  | 4.5999994000 | 5.1999990000 | 0.2675022570 |
  | 4.5999994000 | 5.3999987000 | 0.2716354616 |
  | 4.5999994000 | 5.5999985000 | 0.2772898703 |
  | 4.5999994000 | 5.7999983000 | 0.2813070442 |
  | 4.5999994000 | 5.9999980000 | 0.2852676494 |
  | 4.7999990000 |            3 | 0.2961771579 |
  | 4.7999990000 | 3.2000000000 | 0.2878054594 |
  | 4.7999990000 | 3.4000000000 | 0.2797455871 |
  | 4.7999990000 | 3.6000001000 | 0.2726648497 |
  | 4.7999990000 | 3.8000002000 | 0.2664183237 |
  | 4.7999990000 | 4.0000000000 | 0.2608832193 |
  | 4.7999990000 | 4.2000000000 | 0.2559562481 |
  | 4.7999990000 | 4.3999996000 | 0.2604582649 |
  | 4.7999990000 | 4.5999994000 | 0.2651011927 |
  | 4.7999990000 | 4.7999990000 | 0.2696641998 |
  | 4.7999990000 | 4.9999990000 | 0.2741512710 |
  | 4.7999990000 | 5.1999990000 | 0.2638163470 |
  | 4.7999990000 | 5.3999987000 | 0.2678825391 |
  | 4.7999990000 | 5.5999985000 | 0.2734471237 |
  | 4.7999990000 | 5.7999983000 | 0.2773986242 |
  | 4.7999990000 | 5.9999980000 | 0.2812946173 |
  | 4.9999990000 |            3 | 0.3006988536 |
  | 4.9999990000 | 3.2000000000 | 0.2921753191 |
  | 4.9999990000 | 3.4000000000 | 0.2839717641 |
  | 4.9999990000 | 3.6000001000 | 0.2767650331 |
  | 4.9999990000 | 3.8000002000 | 0.2704074856 |
  | 4.9999990000 | 4.0000000000 | 0.2647740642 |
  | 4.9999990000 | 4.2000000000 | 0.2597595945 |
  | 4.9999990000 | 4.3999996000 | 0.2567178417 |
  | 4.9999990000 | 4.5999994000 | 0.2612819142 |
  | 4.9999990000 | 4.7999990000 | 0.2657676254 |
  | 4.9999990000 | 4.9999990000 | 0.2701788727 |
  | 4.9999990000 | 5.1999990000 | 0.2604439869 |
  | 4.9999990000 | 5.3999987000 | 0.2644488287 |
  | 4.9999990000 | 5.5999985000 | 0.2699314828 |
  | 4.9999990000 | 5.7999983000 | 0.2738228565 |
  | 4.9999990000 | 5.9999980000 | 0.2776596946 |
  | 5.1999990000 |            3 | 0.2824948922 |
  | 5.1999990000 | 3.2000000000 | 0.2764940672 |
  | 5.1999990000 | 3.4000000000 | 0.2699701852 |
  | 5.1999990000 | 3.6000001000 | 0.2641326951 |
  | 5.1999990000 | 3.8000002000 | 0.2589040342 |
  | 5.1999990000 | 4.0000000000 | 0.2542114510 |
  | 5.1999990000 | 4.2000000000 | 0.2499891143 |
  | 5.1999990000 | 4.3999996000 | 0.2461787237 |
  | 5.1999990000 | 4.5999994000 | 0.2451226696 |
  | 5.1999990000 | 4.7999990000 | 0.2492649330 |
  | 5.1999990000 | 4.9999990000 | 0.2533394779 |
  | 5.1999990000 | 5.1999990000 | 0.2573495156 |
  | 5.1999990000 | 5.3999987000 | 0.2612980210 |
  | 5.1999990000 | 5.5999985000 | 0.2667055437 |
  | 5.1999990000 | 5.7999983000 | 0.2705416998 |
  | 5.1999990000 | 5.9999980000 | 0.2743242125 |
  | 5.3999987000 |            3 | 0.2865009054 |
  | 5.3999987000 | 3.2000000000 | 0.2803948929 |
  | 5.3999987000 | 3.4000000000 | 0.2737610342 |
  | 5.3999987000 | 3.6000001000 | 0.2678254680 |
  | 5.3999987000 | 3.8000002000 | 0.2625091632 |
  | 5.3999987000 | 4.0000000000 | 0.2577380418 |
  | 5.3999987000 | 4.2000000000 | 0.2534451020 |
  | 5.3999987000 | 4.3999996000 | 0.2495710253 |
  | 5.3999987000 | 4.5999994000 | 0.2460639523 |
  | 5.3999987000 | 4.7999990000 | 0.2465239380 |
  | 5.3999987000 | 4.9999990000 | 0.2505446701 |
  | 5.3999987000 | 5.1999990000 | 0.2545018848 |
  | 5.3999987000 | 5.3999987000 | 0.2583985052 |
  | 5.3999987000 | 5.5999985000 | 0.2637367981 |
  | 5.3999987000 | 5.7999983000 | 0.2675220934 |
  | 5.3999987000 | 5.9999980000 | 0.2712545671 |
  | 5.5999985000 |            3 | 0.2921513356 |
  | 5.5999985000 | 3.2000000000 | 0.2858767482 |
  | 5.5999985000 | 3.4000000000 | 0.2790736638 |
  | 5.5999985000 | 3.6000001000 | 0.2729936886 |
  | 5.5999985000 | 3.8000002000 | 0.2675528253 |
  | 5.5999985000 | 4.0000000000 | 0.2626731588 |
  | 5.5999985000 | 4.2000000000 | 0.2582847146 |
  | 5.5999985000 | 4.3999996000 | 0.2543258584 |
  | 5.5999985000 | 4.5999994000 | 0.2507429142 |
  | 5.5999985000 | 4.7999990000 | 0.2474894220 |
  | 5.5999985000 | 4.9999990000 | 0.2494461494 |
  | 5.5999985000 | 5.1999990000 | 0.2533549450 |
  | 5.5999985000 | 5.3999987000 | 0.2572043461 |
  | 5.5999985000 | 5.5999985000 | 0.2609969856 |
  | 5.5999985000 | 5.7999983000 | 0.2647352978 |
  | 5.5999985000 | 5.9999980000 | 0.2684215480 |
  | 5.7999983000 |            3 | 0.2960617703 |
  | 5.7999983000 | 3.2000000000 | 0.2896831686 |
  | 5.7999983000 | 3.4000000000 | 0.2827716012 |
  | 5.7999983000 | 3.6000001000 | 0.2765949707 |
  | 5.7999983000 | 3.8000002000 | 0.2710677907 |
  | 5.7999983000 | 4.0000000000 | 0.2661108117 |
  | 5.7999983000 | 4.2000000000 | 0.2616528883 |
  | 5.7999983000 | 4.3999996000 | 0.2576313717 |
  | 5.7999983000 | 4.5999994000 | 0.2539917134 |
  | 5.7999983000 | 4.7999990000 | 0.2506867054 |
  | 5.7999983000 | 4.9999990000 | 0.2476756117 |
  | 5.7999983000 | 5.1999990000 | 0.2509087665 |
  | 5.7999983000 | 5.3999987000 | 0.2547131316 |
  | 5.7999983000 | 5.5999985000 | 0.2584615117 |
  | 5.7999983000 | 5.7999983000 | 0.2621563033 |
  | 5.7999983000 | 5.9999980000 | 0.2657997361 |
  | 5.9999980000 |            3 | 0.2999212243 |
  | 5.9999980000 | 3.2000000000 | 0.2934402175 |
  | 5.9999980000 | 3.4000000000 | 0.2864217993 |
  | 5.9999980000 | 3.6000001000 | 0.2801499628 |
  | 5.9999980000 | 3.8000002000 | 0.2745377571 |
  | 5.9999980000 | 4.0000000000 | 0.2695046197 |
  | 5.9999980000 | 4.2000000000 | 0.2649782525 |
  | 5.9999980000 | 4.3999996000 | 0.2608950082 |
  | 5.9999980000 | 4.5999994000 | 0.2571994793 |
  | 5.9999980000 | 4.7999990000 | 0.2538437210 |
  | 5.9999980000 | 4.9999990000 | 0.2507863665 |
  | 5.9999980000 | 5.1999990000 | 0.2486391269 |
  | 5.9999980000 | 5.3999987000 | 0.2524016641 |
  | 5.9999980000 | 5.5999985000 | 0.2561089377 |
  | 5.9999980000 | 5.7999983000 | 0.2597633088 |
  | 5.9999980000 | 5.9999980000 | 0.2633669746 |


	 #+begin_src gnuplot :var data=bwbw :results file :file ./img/contour-bwbw.png
 # set terminal pngcairo  transparent enhanced font "arial,10" fontscale 1.0 size 600, 400 
 # set output 'contours.1.png'
set terminal qt
set title ""
 set pm3d map 
 set dgrid3d 16,16 gauss 10e-6,10e-6
 set key at screen 1, 0.9 right top vertical Right noreverse enhanced autotitle nobox
 set style increment default
 set style textbox opaque margins  0.5,  0.5 fc  bgnd noborder linewidth  1.0
  set view 46, 120, 1,1
 set contour base
 set style data lines
 set xlabel "Bay width in X dir" 
 set xrange [ * : * ] noreverse writeback
 set x2range [ * : * ] noreverse writeback
 set ylabel "Bay width in Y dir" 
 set yrange [ * : * ] noreverse writeback
 set y2range [ * : * ] noreverse writeback
 set zlabel "T" 
 set zlabel  offset character 1, 0, 0 font "" textcolor lt -1 norotate
 set zrange [ * : * ] noreverse writeback
 set cbrange [ * : * ] noreverse writeback
 set rrange [ * : * ] noreverse writeback
set palette rgbformulae 22,13,10
 splot data  
	 #+end_src

	 #+RESULTS:
	 [[file:./img/contour-bwbw.png]]

For non designed buildings: 
When both bay count are equal : 
If different bay widths are taken on two sides, then the timeperiod is greater than both the timeperiods obtained by considering either of the bay widths in a symmetrical building.
Hence of ease of use, smaller of the bay widths can be considered.
[[./contour-bwbw-export.png]]

But if bay counts are different, then the Timeperiod surface is similar but the valley line is not Bwx = Bwy line.  
[[./img/contour-bwbw-52.png]]

Changing N doesn't change valley points.
#+begin_src lisp 
  (defun valley-points (bx by)
    (loop for bwx from 3 to 6.01 by 0.2
	  for bwy-tps = (loop for bwy from 3 to 6.01 by 0.2
			      for tp = (asym-building-ftp* :number-of-storey 4
							   :height 4
							   :bays-x bx
							   :bays-y by 
							   :bay-width (list bwx bwy)
							   :strut t
							   :designed nil
							   :typical t)
			      collect (list bwy tp))
	  for minima = (find (reduce #'min bwy-tps :key #'second)
			     bwy-tps :key #'second)
	  collect (cons bwx minima)))
#+end_src

#+RESULTS:
: VALLEY-POINTS

#+begin_src lisp 
(valley-points 5 2)
#+end_src

#+RESULTS:
|         3 | 3.6000001 | 1.4440817937969879d0 |
|       3.2 | 3.8000002 | 1.4589957206537953d0 |
|       3.4 |       4.0 | 1.4521526299649685d0 |
| 3.6000001 |       4.2 | 1.4604148000147976d0 |
| 3.8000002 |       4.2 | 1.4561738026002398d0 |
|       4.0 | 4.3999996 |  1.443013195983881d0 |
|       4.2 |  4.799999 | 1.4251786629445127d0 |
| 4.3999996 |  4.999999 | 1.4069710055963172d0 |
| 4.5999994 |  5.199999 | 1.3913489086352768d0 |
|  4.799999 | 5.3999987 | 1.3825300472217736d0 |
|  4.999999 | 5.5999985 | 1.3793005844478248d0 |
|  5.199999 |  5.999998 | 1.3733036566632344d0 |
| 5.3999987 |  5.999998 |  1.375473132527454d0 |
| 5.5999985 |  5.999998 | 1.3943996290485587d0 |
| 5.7999983 |  5.999998 |  1.413072649471339d0 |
|  5.999998 |  5.999998 | 1.4315020910505016d0 |

#+begin_src lisp :results file 
  (with-plot "valley-lines.png"
    (setup :xlabel "Bwx" :ylabel "Bwy")
    (loop for bx from 2 to 3 do
      (loop for by from bx to 5
	    for line = (valley-points bx by) do
	      (ezplot line :title (format nil "~a,~a" bx by)))))

#+end_src

#+RESULTS:
[[file:./img/valley-lines.png]]

#+begin_src lisp
  (loop for bx from 2 to 5
	with result = nil do 
	  (loop for by from bx to 5 
		for bwxbwytps = (loop for bwx from 3 to 6.01 by 0.2
				      for bwy-tps = (loop for bwy from 3 to 6.01 by 0.2
							  for tp = (asym-building-ftp* :number-of-storey 4
										       :height 4
										       :bays-x bx
										       :bays-y by 
										       :bay-width (list bwx bwy)
										       :strut t
										       :designed nil
										       :typical t)
							  collect (list bwy tp))
				      for minima = (find (reduce #'min bwy-tps :key #'second)
							 bwy-tps :key #'second)
				      collect (cons bwx minima))
		for minima = (find (reduce #'min bwxbwytps :key #'third)
				   bwxbwytps :key #'third)
		do 
		   (push  (cons bx (cons by minima)) result))
	  finally (return result))
#+end_src

#+RESULTS:
| 5 | 5 | 5.999998 |  5.999998 | 1.3903091985155824d0 |
| 4 | 5 | 5.999998 | 5.7999983 | 1.3905527263616788d0 |
| 4 | 4 | 5.999998 |  5.999998 | 1.3770935961460253d0 |
| 3 | 5 | 5.999998 | 5.5999985 |  1.380901238713991d0 |
| 3 | 4 | 5.999998 | 5.7999983 |  1.370874121908982d0 |
| 3 | 3 | 5.999998 |  5.999998 | 1.3570465792606696d0 |
| 2 | 5 | 5.999998 |  5.199999 | 1.3733036566630814d0 |
| 2 | 4 | 5.999998 | 5.3999987 | 1.3558959761796903d0 |
| 2 | 3 | 5.999998 | 5.5999985 |  1.343691708636285d0 |
| 2 | 2 | 5.999998 |  5.999998 | 1.3230198429668576d0 |
